<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de CNPJ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        /* Adiciona um pouco de profundidade ao texto */
        body {
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-indigo-200 text-gray-800 font-sans min-h-screen">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="max-w-3xl mx-auto">
            
            <!-- Cabeçalho e Input -->
            <div class="bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-lg mb-8 border border-gray-200">
                <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-4">Sistema de Consulta de CNPJ</h1>
                <p class="text-center text-gray-600 mb-6">Digite um CNPJ para obter os dados da empresa.</p>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="text" id="cnpj-input" placeholder="00.000.000/0000-00" class="flex-grow w-full px-4 py-3 text-gray-700 bg-white/70 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition shadow-sm">
                    <button id="search-btn" class="w-full sm:w-auto bg-indigo-600 text-white px-8 py-3 font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 duration-200 flex items-center justify-center shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        Buscar
                    </button>
                </div>
            </div>

            <!-- Area de Resultados -->
            <div id="results" class="space-y-8" style="display: none;">
                <!-- Card: Dados Principais -->
                <div class="bg-white/70 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-gray-200 border-t-4 border-t-blue-500">
                    <h2 class="text-xl font-semibold p-4 bg-blue-50 text-blue-800">Dados Principais</h2>
                    <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                        <div><strong class="font-medium text-gray-600">Razão Social:</strong> <span id="razao_social" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Nome Fantasia:</strong> <span id="nome_fantasia" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">CNPJ:</strong> <span id="cnpj" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Situação Cadastral:</strong> <span id="situacao_cadastral" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Data de Abertura:</strong> <span id="data_inicio_atividade" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Porte:</strong> <span id="porte" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Natureza Jurídica:</strong> <span id="natureza_juridica" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Capital Social:</strong> <span id="capital_social" class="text-gray-900"></span></div>
                    </div>
                </div>

                <!-- Card: Endereço -->
                <div class="bg-white/70 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-gray-200 border-t-4 border-t-green-500">
                    <h2 class="text-xl font-semibold p-4 bg-green-50 text-green-800">Endereço</h2>
                    <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                        <div><strong class="font-medium text-gray-600">Logradouro:</strong> <span id="logradouro" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Número:</strong> <span id="numero" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Complemento:</strong> <span id="complemento" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Bairro:</strong> <span id="bairro" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">CEP:</strong> <span id="cep" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Município:</strong> <span id="municipio" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">UF:</strong> <span id="uf" class="text-gray-900"></span></div>
                    </div>
                </div>

                <!-- Card: Contato -->
                <div class="bg-white/70 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-gray-200 border-t-4 border-t-yellow-500">
                    <h2 class="text-xl font-semibold p-4 bg-yellow-50 text-yellow-800">Contato</h2>
                    <div class="p-6 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                        <div><strong class="font-medium text-gray-600">E-mail:</strong> <span id="email" class="text-gray-900"></span></div>
                        <div><strong class="font-medium text-gray-600">Telefone:</strong> <span id="ddd_telefone_1" class="text-gray-900"></span></div>
                    </div>
                </div>

                <!-- Card: Atividades (CNAE) -->
                <div class="bg-white/70 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-gray-200 border-t-4 border-t-purple-500">
                    <h2 class="text-xl font-semibold p-4 bg-purple-50 text-purple-800">Atividades Econômicas (CNAE)</h2>
                    <div class="p-6">
                        <div>
                            <strong class="font-medium text-gray-600 block mb-2">Atividade Principal:</strong>
                            <p id="cnae_principal" class="text-gray-900"></p>
                        </div>
                        <div class="mt-4">
                            <strong class="font-medium text-gray-600 block mb-2">Atividades Secundárias:</strong>
                            <ul id="cnaes_secundarios" class="list-disc list-inside text-gray-700 space-y-2"></ul>
                        </div>
                    </div>
                </div>

                <!-- Card: Quadro de Sócios e Administradores (QSA) -->
                <div class="bg-white/70 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-gray-200 border-t-4 border-t-red-500">
                    <h2 class="text-xl font-semibold p-4 bg-red-50 text-red-800">Quadro de Sócios e Administradores (QSA)</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50/50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qualificação</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Entrada</th>
                                </tr>
                            </thead>
                            <tbody id="qsa-table" class="bg-white divide-y divide-gray-200">
                                <!-- Linhas da tabela serão inseridas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Indicador de Carregamento -->
            <div id="loader" class="text-center py-10" style="display: none;">
                <div class="inline-block w-10 h-10 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
                <p class="mt-3 text-lg font-semibold text-gray-700">Buscando dados...</p>
            </div>

            <!-- Mensagem de Erro -->
            <div id="error-message" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg relative text-center shadow-md" style="display: none;" role="alert">
                <strong class="font-bold block">Ocorreu um erro!</strong>
                <span class="block" id="error-text"></span>
            </div>

        </div>
    </div>

    <script>
        const searchBtn = document.getElementById('search-btn');
        const cnpjInput = document.getElementById('cnpj-input');
        const resultsDiv = document.getElementById('results');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');

        // Formata a data para o padrão brasileiro
        const formatDate = (dateStr) => {
            if (!dateStr) return 'N/A';
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${year}`;
        };

        // Formata o CNPJ com a máscara
        const formatCnpj = (cnpj) => {
            if (!cnpj) return 'N/A';
            return cnpj.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/, '$1.$2.$3/$4-$5');
        };
        
        // Formata o CEP com a máscara
        const formatCep = (cep) => {
            if (!cep) return 'N/A';
            return cep.replace(/^(\d{5})(\d{3})$/, '$1-$3');
        };

        // Formata o valor monetário
        const formatCurrency = (value) => {
            if (value === null || value === undefined) return 'N/A';
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        const displayData = (data) => {
            // Dados Principais
            document.getElementById('razao_social').textContent = data.razao_social || 'N/A';
            document.getElementById('nome_fantasia').textContent = data.nome_fantasia || 'N/A';
            document.getElementById('cnpj').textContent = formatCnpj(data.cnpj);
            document.getElementById('situacao_cadastral').textContent = data.descricao_situacao_cadastral || 'N/A';
            document.getElementById('data_inicio_atividade').textContent = formatDate(data.data_inicio_atividade);
            document.getElementById('porte').textContent = data.porte || 'N/A';
            document.getElementById('natureza_juridica').textContent = data.natureza_juridica || 'N/A';
            document.getElementById('capital_social').textContent = formatCurrency(data.capital_social);

            // Endereço
            document.getElementById('logradouro').textContent = data.logradouro || 'N/A';
            document.getElementById('numero').textContent = data.numero || 'N/A';
            document.getElementById('complemento').textContent = data.complemento || 'N/A';
            document.getElementById('bairro').textContent = data.bairro || 'N/A';
            document.getElementById('cep').textContent = formatCep(data.cep);
            document.getElementById('municipio').textContent = data.municipio || 'N/A';
            document.getElementById('uf').textContent = data.uf || 'N/A';

            // Contato
            document.getElementById('email').textContent = data.email || 'N/A';
            document.getElementById('ddd_telefone_1').textContent = data.ddd_telefone_1 || 'N/A';

            // CNAE
            document.getElementById('cnae_principal').textContent = `${data.cnae_fiscal} - ${data.cnae_fiscal_descricao}` || 'N/A';
            const cnaesSecundariosList = document.getElementById('cnaes_secundarios');
            cnaesSecundariosList.innerHTML = '';
            if (data.cnaes_secundarios && data.cnaes_secundarios.length > 0) {
                data.cnaes_secundarios.forEach(cnae => {
                    const li = document.createElement('li');
                    li.textContent = `${cnae.codigo} - ${cnae.descricao}`;
                    cnaesSecundariosList.appendChild(li);
                });
            } else {
                cnaesSecundariosList.innerHTML = '<li>Nenhuma atividade secundária informada.</li>';
            }

            // QSA
            const qsaTable = document.getElementById('qsa-table');
            qsaTable.innerHTML = '';
            if (data.qsa && data.qsa.length > 0) {
                data.qsa.forEach(socio => {
                    const row = qsaTable.insertRow();
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">${socio.nome_socio}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${socio.qualificacao_socio}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(socio.data_entrada_sociedade)}</td>
                    `;
                });
            } else {
                 const row = qsaTable.insertRow();
                 row.innerHTML = `<td colspan="3" class="px-6 py-4 text-center text-sm text-gray-500">Quadro de sócios não informado.</td>`;
            }

            // Exibe os resultados
            resultsDiv.style.display = 'block';
        };

        const fetchCnpjData = async () => {
            const cnpj = cnpjInput.value.replace(/\D/g, ''); // Remove caracteres não numéricos

            if (cnpj.length !== 14) {
                errorText.textContent = 'CNPJ inválido. Por favor, digite os 14 números.';
                errorMessage.style.display = 'block';
                resultsDiv.style.display = 'none';
                return;
            }

            // Reset UI
            resultsDiv.style.display = 'none';
            errorMessage.style.display = 'none';
            loader.style.display = 'block';

            try {
                const response = await fetch(`https://minhareceita.org/${cnpj}`);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => null);
                    const detail = errorData?.detail || `Erro ${response.status} - Não foi possível buscar os dados.`;
                    throw new Error(detail);
                }

                const data = await response.json();
                displayData(data);

            } catch (error) {
                errorText.textContent = error.message || 'Não foi possível conectar à API.';
                errorMessage.style.display = 'block';
            } finally {
                loader.style.display = 'none';
            }
        };

        searchBtn.addEventListener('click', fetchCnpjData);
        cnpjInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                fetchCnpjData();
            }
        });

    </script>

</body>
</html>
